<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link
	href="https://fonts.googleapis.com/css2?family=Anton&family=Edu+VIC+WA+NT+Beginner:wght@600&family=Gamja+Flower&family=Single+Day&family=Jua&family=Nanum+Pen+Script&display=swap"
	rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
<style type="text/css">
	*{
		font-family: 'Jua';
	}
	
	div.box{
		width: 100px;
		height: 30px;
		border: 1px solid black;
	}
	
	b.a{
		background-color: yellow;
		
	}
	
	i.delete{ 
		cursor:pointer;
		color: orange;
		/* margin-left: 150px; */
		float: right;
	}
	i.addform{
		/* margin-left: 20px; 여기선 적용안돼서 인라인으로 적용*/
		cursor: pointer;
	}
	
	div.inputform{
		position: absolute;
		left: 650px;
		top: 100px;
		width: 400px;
	}
</style>

<script>
	$(function() {
		//처음 시작 시 전체 상품 출력
		search("");
		
		//inputform 안보이게 처리
		$("div.inputform").hide();
		
		// +플러스 아이콘 클릭 시 입력폼 나타났다 사라졌다 하기
		$("i.addform").click(function() {
			$("div.inputform").slideToggle();
		});
		
		
		//myshop에서 shopform 의 script 가져옴
		//select 의 선택된 값 얻기
		var srcImg=$("#photo").val();
		//작은 이미지의 src에 넣어준다
		$("#myphoto").attr("src","../image2/"+srcImg+".jpg");
		
		//상품 추가버튼 이벤트
		//숨겨져있을뿐 이미 있는 버튼이라서 on 도되지만 click으로 줘도됨
		$("#btnsave").click(function () {
			var sangpum=$("#addsangpum").val();
			var photo=$("#photo").val();
			var color=$("#addcolor").val();
			var price=$("#addprice").val();
			var ipgoday=$("#addipgoday").val();
			
			$.ajax({
				type: "get",
				url: "ex3_addsangpum.jsp",
				dataType: "html",
				data:{"sangpum":sangpum,"photo":photo,"color":color,"price":price,"ipgoday":ipgoday},
				success:function(res){
				
				alert(sangpum+" 상품이 추가되었습니다");
				//리로드 해서 페이지 다시 불러오기
				location.reload();

				},
				statusCode: {
					404:function(){
						alert("json 파일을 찾을 수 없어요!");
					},
					500:function(){
						alert("서버 오류..코드를 다시 한번 확인하세요!");
					}
				}

			});
			
		});
	
		
		//상품명 입력 후 엔터누르면 함수 호출
		$("#sangpum").keyup(function (e) {
			if(e.keyCode==13){
				search($(this).val().trim());	//앞뒤 공백 제거 후 this(=#sangpum)의 value 값 보내기
			}
		});
		
		//검색 버튼 클릭 시 
		$("#btn1").click(function() {
			search($("#sangpum").val().trim());
		});
		
		//휴지통 아이콘 클릭 시 num값 얻기
		$(document).on("click","i.delete",function () {
			var num=$(this).attr("num");
			//alert(num);
			var a=confirm("삭제하려면 [확인]을 클릭하세요");
			
			if(!a)	//취소 선택 시 함수 종료
				return;
			
			
			
			$.ajax({
				type: "get",
				url: "ex3_myshopdelete.jsp",
				data: {"num":num},
				dataType: "html",
				success:function(res){
					//삭제는 바로 진행됨
					//전체 새로고침
					//location.reload();
					
					//검색버튼 호출
					$("#btn1").trigger("click");
					
				},
				statusCode: {
					404:function(){
						alert("json 파일을 찾을 수 없어요!");
					},
					500:function(){
						alert("서버 오류..코드를 다시 한번 확인하세요!");
					}
				}

			});
			
			
			
			
			
			
		});
		
		
	});
	
	//호출하는 함수라서 $(function 밖에다가 작성했음
	function search(sangpum) {
		//alert(sangpum);
		
	$.ajax({
		type: "get",
		url: "ex3_myshopjson.jsp",
		dataType: "json",
		data: {"sangpum":sangpum},
		success:function(res){
			
			var s="<table class='table table-bordered'>";
			
			$.each(res,function(idx,item){
				s+="<tr>";
				s+="<td width='200' rowspan=3 align=center>";
				s+="<img src='"+item.photo+"' width=180>";
				s+="</td>";
				
				//검색한 단어에 css 적용하기
				//예 : item.sangpum 은 전체 상품명 (레이스 조끼,   조끼 -> <b class=a>조끼</b>)
				var ss=item.sangpum.replace(sangpum,"<b class='a'>"+sangpum+"</b>");
				s+="<td valign=middle>상품명 : "+ss+
					"<i class='fas fa-trash-alt delete' style='font-size:22px;' num="+item.num+"></i></td>";
				s+="</tr>";
				
				s+="<tr><td valign=middle><div style='background-color:"+item.color+"' class=box></div></td></tr>";
				
				s+="<tr><td valign=middle>가격: "+item.price+"</td></tr>";
			});
						
			s+="</table>";
			$("#result").html(s);
		},
		statusCode: {
			404:function(){
				alert("json 파일을 찾을 수 없어요!");
			},
			500:function(){
				alert("서버 오류..코드를 다시 한번 확인하세요!");
			}
		}

	});
		
	}
	
</script>

</head>
<body>
<div style="margin: 30px; width:500px;">
	<div class="input-group">
		<h3>상품명 검색</h3>&nbsp;&nbsp;
		<input type="text" class="form-control" style="width: 130px;"id= "sangpum">
		<button type="button" class="btn btn-secondary" id="btn1">검색</button>
		
		<i class='fas fa-plus addform' style='font-size:40px;color:lightgray; margin-left: 10px'></i>
	</div>
	
	<div id="result" style="margin-top: 30px;">
		
	</div>
</div>

<div class="inputform">
	<table class="table table-bordered" style="width: 400px;">
				<caption align="top"><h4><b>상품등록</b></h4></caption>
				<tr>
					<th width="100" style="background-color: lightgray;">상품명</th>
					<td>
						<input type="text" id="addsangpum" required="required"
						class="form-control">
						<!-- 빈 문자열로 insert되는걸 방지하기위한 required 필수입력값 속성 부여 -->
						<!-- submit일때만 가능하고 button 타입은 required 사용 불가함 -->
					</td>
				</tr>
				
				<tr>
					<th width="100" style="background-color: lightgray">상품사진</th>
					<td>
						<div class="input-group">
						<select name="photo"  class="form-select" style="width: 150px;" id="photo">
							<option value="11">단화</option>
							<option value="10">스카프</option>
							<option value="29">모자</option>
							<option value="31">화이트자켓</option>
							<option value="33">원피스</option>
							<option value="26">머리끈</option>
							<option value="30">머리띠</option>
						</select>
						<img src="" width="40" height="40" id="myphoto">
						</div>
						
							<script type="text/javascript">
								//select 변경 시 사진도 변경되도록 이벤트 추가하기
								$("#photo").change(function() {
									var src="../image2/"+$(this).val()+".jpg";
									$("#myphoto").attr("src",src);
								});
							</script>
					</td>
				</tr>
				
				<tr>
					<th width="100" style="background-color: lightgray">색상</th>
					<td>
						<input type="color" id="addcolor" value="#ffc0cb"
						class="form-control" style="width: 100px;">
					</td>
				</tr>
				
				<tr>
					<th width="100" style="background-color: lightgray">가격</th>
					<td>
						<input type="text" id="addprice" required="required"
						class="form-control" pattern="[0-9]{3,}"> <!-- 0~9만 입력가능, 3글자 이상 -->
						<!-- pattern 속성을 통해 숫자만 받을 수 있음 -->
					</td>
				</tr>
				
				<tr>
					<th width="100" style="background-color: lightgray">입고일</th>
					<td>
						<input type="date" id="addipgoday" value="2022-08-22" 
						class="form-control">
						
					</td>
				</tr>
				
				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-secondary" id="btnsave">상품저장</button>
						
					</td>
				</tr>
				
			</table>
</div>
</body>
</html>
